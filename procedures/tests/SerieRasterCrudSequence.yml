# yaml-language-server: $schema=../../public/schemas/sequence.json 
sequence:
- procedureName: DownloadFromAccessorProcedure
  arguments:
    accessor_id: a5
    filter:
      tipo: raster
      series_id: 3
      timestart: 2023-02-01 09:00:00
      timeend: 2023-02-04 09:00:00
    output_format: raster
    options:
      output_individual_files:
        base_path: sample_data
        pattern: serie.rast.{{id}}.{{timestart}}
        iter_field: observaciones
  tests:
  - testName: ResultIsInstanceOfTest
    arguments:
      class_name: serie
  - testName: OutputFileTest
    arguments:
      class_name: observacion
      output: sample_data/serie.rast.3.2023-02-01T12:00:00.000Z.tif
      output_format: raster
      result_deep_property: 0.observaciones.0
- procedureName: CreateProcedure
  arguments:
    class_name: serie
    jsonfile: sample_data/serie_raster.json
- procedureName: CreateProcedure
  arguments:
    class_name: observacion
    # elements:
    rasterfile: sample_data/serie.rast.3.2023-02-01T12:00:00.000Z.tif
    output: /tmp/created_obs.tif
    output_format: raster
    options:
      upsert_estacion: true
  tests:
  - testName: ArrayLengthTest
    arguments:
      min_length: 1
  - testName: ResultIsInstanceOfTest
    arguments:
      class_name: observacion
  - testName: OutputFileTest
    arguments:
      class_name: observacion
      output: /tmp/created_obs.tif
      output_format: raster
      index: 0
- procedureName: ReadProcedure
  arguments:
    class_name: observacion
    filter:
      tipo: raster
      series_id: 3
      timestart: 2023-02-01T12:00:00.000Z
    output: /tmp/read_obs.tif
    output_format: raster 
  tests:
  - testName: ArrayLengthTest
    arguments:
      min_length: 1
  - testName: ResultIsInstanceOfTest
    arguments:
      class_name: observacion
  - testName: OutputFileTest
    arguments:
      class_name: observacion
      output: /tmp/read_obs.tif
      output_format: raster
      index: 0
- procedureName: UpdateProcedure
  arguments:
    class_name: observacion
    filter:
      tipo: raster
      series_id: 3
      timestart: 2023-02-01T12:00:00.000Z
    update:
      timeupdate: 2023-03-01T12:00:00.001Z
    output: /tmp/updated_obs.tif 
    output_format: raster
  tests:
  - testName: PropertyEqualsTest
    arguments:
      property_name: timeupdate
      property_value: 2023-03-01T12:00:00.001Z
  - testName: ArrayLengthTest
    arguments:
      min_length: 1
      max_length: 1
  - testName: OutputFileTest
    arguments:
      class_name: observacion
      output_format: raster
      index: 0
      output: /tmp/updated_obs.tif
- procedureName: DeleteProcedure
  arguments:
    class_name: observacion
    filter:
      tipo: raster
      series_id: 3
      timestart: 2023-02-01T12:00:00.000Z 
    output: /tmp/deleted_obs.tif
    output_format: raster
  tests:
  - testName: PropertyEqualsTest
    arguments:
      property_name: timestart
      property_value: 2023-02-01T12:00:00.000Z
  - testName: ArrayLengthTest
    arguments:
      min_length: 1
      max_length: 1
  - testName: OutputFileTest
    arguments:
      class_name: observacion
      output: /tmp/deleted_obs.tif
      output_format: raster
      index: 0